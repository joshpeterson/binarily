<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Binarily</title>
    <script>
      function readFile(file) {
        return new Promise((resolve, reject) => {
          let fr = new FileReader();
          fr.onload = x=> resolve(fr.result);
          fr.readAsArrayBuffer(file);
      })}

      function enableFileInput() {
        document.getElementById("fileInput").disabled = false;
      }

      async function analyzeFile(input) {
        var fileBuffer = await readFile(input.files[0]);
        const typedArray = new Uint8Array(fileBuffer);
        var heapSpace = Module._malloc(typedArray.length);
        Module.HEAPU8.set(typedArray, heapSpace);

        var fileData = Module.ccall('loadFileData', 'number', ['number', 'number'], [heapSpace, typedArray.length]);

        msg.innerText = UTF8ToString(fileData);

        Module._free(fileData);
      }
    </script>
  </head>
  <body>
    Choose a file to analyze: <input type="file" id="fileInput" onchange="analyzeFile(this)" disabled/>
    <h3>File Information</h3>
    <pre id="msg"></pre>
    {{{ SCRIPT }}}
  </body>
</html>
